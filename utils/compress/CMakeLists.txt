INCLUDE_DIRECTORIES (${ENGINE_COMMON_INCLUDES} ${SNAPPY_INCLUDE_DIR})

# hack for lz4 duplicate header
GET_PROPERTY (
  dirs
  DIRECTORY
  PROPERTY INCLUDE_DIRECTORIES
)
LIST (REMOVE_ITEM dirs ${CMAKE_SOURCE_DIR}/include/providers)
SET_PROPERTY (DIRECTORY PROPERTY INCLUDE_DIRECTORIES "${dirs}")

SET (compress_LIB_SRCS idbcompress.cpp)

ADD_DEFINITIONS (-DNDEBUG)

IF (COLUMNSTORE_ALL_STATIC)
  ADD_LIBRARY (compress STATIC ${compress_LIB_SRCS})
ELSE ()
  ADD_LIBRARY (compress SHARED ${compress_LIB_SRCS})
ENDIF ()

ADD_DEPENDENCIES (compress loggingcpp external_boost)

TARGET_LINK_LIBRARIES (compress ${SNAPPY_LIBRARIES})
IF (HAVE_LZ4)
  MESSAGE_ONCE (STATUS "LINK WITH LZ4")
  TARGET_LINK_LIBRARIES (compress ${LZ4_LIBRARIES})
ENDIF ()

INSTALL (
  TARGETS compress
  DESTINATION ${ENGINE_LIBDIR}
  COMPONENT columnstore-engine
)
