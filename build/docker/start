#!/bin/bash

set -euo pipefail
IFS=$'\n\t'

# check for MDB, columnstore and regression tests suite.
ABOVE_MDB_ROOT=../../../../../.. # good enough for tests.

if [ ! -f $ABOVE_MDB_ROOT/MariaDBEnterprise/storage/columnstore/columnstore/build/docker/start ]; then
  echo "Can't detect MDB and columnstore."
  exit 1
fi
if [ ! -f $ABOVE_MDB_ROOT/mariadb-columnstore-regression-test/dev-scripts/README ]; then
  echo "Can't find regression test suite."
fi

docker rmi -f do-not-publish-roli8-curr-mdb
echo "# ignoring .git"  > $ABOVE_MDB_ROOT/.dockerignore
echo "*/.git"          >> $ABOVE_MDB_ROOT/.dockerignore
# Adding sources and building the dependencies.
DOCKER_BUILDKIT=1 docker build -f Dockerfile_start -t do-not-publish-roli8-curr-mdb $ABOVE_MDB_ROOT
