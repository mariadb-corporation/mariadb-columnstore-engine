#
# Test PERCENTILE_DISC() Window Function
# Author: Bharath, bharath.bokka@mariadb.com
#
-- source ../include/have_columnstore.inc

--disable_warnings
DROP DATABASE IF EXISTS mcs133_db;
--enable_warnings

CREATE DATABASE mcs133_db;
USE mcs133_db;

CREATE TABLE t1 (a CHAR(1), b INT)ENGINE=Columnstore;
INSERT INTO t1 VALUES ('', NULL),('a', 12),('a', 13),('b', 14),('b', 15),('b', 16),('b', 17),('b', 18),('a', 19);

SELECT a, b, PERCENTILE_DISC(1) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.1) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.5) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.6) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.61) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.65) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.69) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.7) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY a DESC) pd FROM t1;
						
SELECT a, b, PERCENTILE_DISC(0) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(1) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.1) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.5) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.6) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.61) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.65) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.69) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.7) WITHIN GROUP(ORDER BY b) OVER(PARTITION BY b DESC) pd FROM t1;
						
SELECT a, b, PERCENTILE_DISC(0) WITHIN GROUP(ORDER BY b DESC) OVER(PARTITION BY b) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0) WITHIN GROUP(ORDER BY b DESC) OVER(PARTITION BY a) pd FROM t1;

SELECT a, b, PERCENTILE_DISC(0) WITHIN GROUP(ORDER BY a DESC) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(1) WITHIN GROUP(ORDER BY a DESC) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.5) WITHIN GROUP(ORDER BY a DESC) OVER(PARTITION BY a DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0) WITHIN GROUP(ORDER BY a DESC) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(1) WITHIN GROUP(ORDER BY a DESC) OVER(PARTITION BY b DESC) pd FROM t1;
SELECT a, b, PERCENTILE_DISC(0.5) WITHIN GROUP(ORDER BY a DESC) OVER(PARTITION BY b DESC) pd FROM t1;

# Expected error ER_ARGUMENT_OUT_OF_RANGE
--error ER_INTERNAL_ERROR
SELECT a, b, PERCENTILE_DISC(-0.9) WITHIN GROUP(ORDER BY b DESC) OVER(PARTITION BY b DESC) pd FROM t1;
# Expected error ER_ARGUMENT_OUT_OF_RANGE
--error ER_INTERNAL_ERROR
SELECT a, b, PERCENTILE_DISC(-1) WITHIN GROUP(ORDER BY b DESC) OVER(PARTITION BY b DESC) pd FROM t1;
# Expected error ER_ARGUMENT_OUT_OF_RANGE
--error ER_INTERNAL_ERROR
SELECT a, b, PERCENTILE_DISC(1.1) WITHIN GROUP(ORDER BY b DESC) OVER(PARTITION BY b DESC) pd FROM t1;

# Clean UP
DROP DATABASE mcs133_db;
