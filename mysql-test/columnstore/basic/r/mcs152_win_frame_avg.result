DROP DATABASE IF EXISTS mcs152_db;
CREATE DATABASE mcs152_db;
USE mcs152_db;
CREATE TABLE t1 (a CHAR(1), b INT)ENGINE=Columnstore;
INSERT INTO t1 VALUES ('', NULL),('a', 12),('a', 13),('b', 14),('c', 15),('d', 16),('d', 17),('b', 18),('a', 19);
SELECT a, b, AVG(b) OVER(ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	12.5000
b	14	13.0000
c	15	13.5000
d	16	14.0000
d	17	14.5000
b	18	15.0000
a	19	15.5000
SELECT a, b, AVG(b) OVER(ORDER BY b RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	15.5000
a	12	15.5000
a	13	16.0000
b	14	16.5000
c	15	17.0000
d	16	17.5000
d	17	18.0000
b	18	18.5000
a	19	19.0000
SELECT a, b, AVG(b) OVER(ORDER BY b ROWS BETWEEN 1 PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	12.5000
b	14	13.5000
c	15	14.5000
d	16	15.5000
d	17	16.5000
b	18	17.5000
a	19	18.5000
SELECT a, b, AVG(b) OVER(ORDER BY b ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	12.0000
a	12	12.5000
a	13	13.0000
b	14	14.0000
c	15	15.0000
d	16	16.0000
d	17	17.0000
b	18	18.0000
a	19	18.5000
SELECT a, b, AVG(b) OVER(ORDER BY b ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	15.5000
a	12	15.5000
a	13	15.5000
b	14	16.0000
c	15	16.5000
d	16	17.0000
d	17	17.5000
b	18	18.0000
a	19	18.5000
SELECT a, b, AVG(b) OVER(ORDER BY b DESC RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
a	19	19.0000
b	18	18.5000
d	17	18.0000
d	16	17.5000
c	15	17.0000
b	14	16.5000
a	13	16.0000
a	12	15.5000
NULL	NULL	15.5000
SELECT a, b, AVG(b) OVER(ORDER BY b DESC RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
a	19	15.5000
b	18	15.0000
d	17	14.5000
d	16	14.0000
c	15	13.5000
b	14	13.0000
a	13	12.5000
a	12	12.0000
NULL	NULL	NULL
SELECT a, b, AVG(b) OVER(ORDER BY b DESC ROWS BETWEEN 1 PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
a	19	19.0000
b	18	18.5000
d	17	17.5000
d	16	16.5000
c	15	15.5000
b	14	14.5000
a	13	13.5000
a	12	12.5000
NULL	NULL	12.0000
SELECT a, b, AVG(b) OVER(ORDER BY b DESC ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) avg FROM t1;
a	b	avg
a	19	18.5000
b	18	18.0000
d	17	17.0000
d	16	16.0000
c	15	15.0000
b	14	14.0000
a	13	13.0000
a	12	12.5000
NULL	NULL	12.0000
SELECT a, b, AVG(b) OVER(ORDER BY b DESC ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
a	19	15.5000
b	18	15.5000
d	17	15.0000
d	16	14.5000
c	15	14.0000
b	14	13.5000
a	13	13.0000
a	12	12.5000
NULL	NULL	12.0000
SELECT a, b, AVG(b) OVER(PARTITION BY a ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	12.5000
a	19	14.6667
b	14	14.0000
b	18	16.0000
c	15	15.0000
d	16	16.0000
d	17	16.5000
SELECT a, b, AVG(b) OVER(PARTITION BY b ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	13.0000
b	14	14.0000
c	15	15.0000
d	16	16.0000
d	17	17.0000
b	18	18.0000
a	19	19.0000
SELECT a, b, AVG(b) OVER(PARTITION BY a ORDER BY b RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	14.6667
a	13	16.0000
a	19	19.0000
b	14	16.0000
b	18	18.0000
c	15	15.0000
d	16	16.5000
d	17	17.0000
SELECT a, b, AVG(b) OVER(PARTITION BY b ORDER BY b RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	13.0000
b	14	14.0000
c	15	15.0000
d	16	16.0000
d	17	17.0000
b	18	18.0000
a	19	19.0000
SELECT a, b, AVG(b) OVER(PARTITION BY a ORDER BY b ROWS BETWEEN 1 PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	12.5000
a	19	16.0000
b	14	14.0000
b	18	16.0000
c	15	15.0000
d	16	16.0000
d	17	16.5000
SELECT a, b, AVG(b) OVER(PARTITION BY b ORDER BY b ROWS BETWEEN 1 PRECEDING AND CURRENT ROW) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	13.0000
b	14	14.0000
c	15	15.0000
d	16	16.0000
d	17	17.0000
b	18	18.0000
a	19	19.0000
SELECT a, b, AVG(b) OVER(PARTITION BY a ORDER BY b ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.5000
a	13	14.6667
a	19	16.0000
b	14	16.0000
b	18	16.0000
c	15	15.0000
d	16	16.5000
d	17	16.5000
SELECT a, b, AVG(b) OVER(PARTITION BY b ORDER BY b ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	13.0000
b	14	14.0000
c	15	15.0000
d	16	16.0000
d	17	17.0000
b	18	18.0000
a	19	19.0000
SELECT a, b, AVG(b) OVER(PARTITION BY a ORDER BY b ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	14.6667
a	13	14.6667
a	19	16.0000
b	14	16.0000
b	18	16.0000
c	15	15.0000
d	16	16.5000
d	17	16.5000
SELECT a, b, AVG(b) OVER(PARTITION BY b ORDER BY b ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) avg FROM t1;
a	b	avg
NULL	NULL	NULL
a	12	12.0000
a	13	13.0000
b	14	14.0000
c	15	15.0000
d	16	16.0000
d	17	17.0000
b	18	18.0000
a	19	19.0000
SELECT a, b, AVG(b) OVER(PARTITION BY b RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) avg FROM t1;
ERROR HY000: RANGE-type frame requires ORDER BY clause with single sort key
SELECT a, b, AVG(b) OVER(ORDER BY a RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) avg FROM t1;
ERROR HY000: Numeric datatype is required for RANGE-type frame
DROP DATABASE mcs152_db;
