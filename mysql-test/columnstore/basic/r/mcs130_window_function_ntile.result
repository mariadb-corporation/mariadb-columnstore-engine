DROP DATABASE IF EXISTS mcs130_db;
CREATE DATABASE mcs130_db;
USE mcs130_db;
CREATE TABLE t1 (a CHAR(1), b INT)ENGINE=Columnstore;
INSERT INTO t1 VALUES ('', NULL),('a', 123),('a', 1),('b', 123),('c', 1861),('c', 1991),('d', 10701),('d', 1071),('a', 92);
SELECT a, b, NTILE(3) OVER(ORDER BY b DESC) ntile FROM t1;
a	b	ntile
d	10701	1
c	1991	1
c	1861	1
d	1071	2
a	123	2
b	123	2
a	92	3
a	1	3
NULL	NULL	3
SELECT a, b, NTILE(4) OVER(ORDER BY a DESC) ntile FROM t1;
a	b	ntile
d	10701	1
d	1071	1
c	1861	1
c	1991	2
b	123	2
a	92	3
a	123	3
a	1	4
NULL	NULL	4
SELECT a, b, NTILE(3) OVER w ntile FROM t1 WINDOW w AS (ORDER BY a DESC);
a	b	ntile
d	10701	1
d	1071	1
c	1861	1
c	1991	2
b	123	2
a	92	2
a	123	3
a	1	3
NULL	NULL	3
SELECT a, b, NTILE(3) OVER w ntile FROM t1 WINDOW w AS (ORDER BY b);
a	b	ntile
NULL	NULL	1
a	1	1
a	92	1
b	123	2
a	123	2
d	1071	2
c	1861	3
c	1991	3
d	10701	3
SELECT a, b, NTILE(3) OVER(PARTITION BY b) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	1	1
a	92	1
b	123	1
a	123	2
d	1071	1
c	1861	1
c	1991	1
d	10701	1
SELECT a, b, NTILE(3) OVER(PARTITION BY a) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	92	1
a	1	2
a	123	3
b	123	1
c	1991	1
c	1861	2
d	1071	1
d	10701	2
SELECT a, b, NTILE(3) OVER(PARTITION BY a ORDER BY b DESC) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	123	1
a	92	2
a	1	3
b	123	1
c	1991	1
c	1861	2
d	10701	1
d	1071	2
SELECT a, b, NTILE(3) OVER(PARTITION BY b ORDER BY b DESC) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	1	1
a	92	1
b	123	1
a	123	2
d	1071	1
c	1861	1
c	1991	1
d	10701	1
SELECT a, b, NTILE(3) OVER(PARTITION BY a ORDER BY b ASC) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	1	1
a	92	2
a	123	3
b	123	1
c	1861	1
c	1991	2
d	1071	1
d	10701	2
SELECT a, b, NTILE(3) OVER(PARTITION BY b ORDER BY b DESC) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	1	1
a	92	1
b	123	1
a	123	2
d	1071	1
c	1861	1
c	1991	1
d	10701	1
SELECT a, b, NTILE(-1) OVER(PARTITION BY b ORDER BY b DESC) ntile FROM t1;
a	b	ntile
NULL	NULL	1
a	1	1
a	92	1
b	123	1
a	123	2
d	1071	1
c	1861	1
c	1991	1
d	10701	1
SELECT a, b, NTILE(0) OVER(PARTITION BY b ORDER BY b DESC) ntile FROM t1;
ERROR HY000: Internal error: MCS-9027: Argument '0' is out of range.
SELECT a, b, NTILE(3) OVER(PARTITION BY a ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) ntile FROM t1;
ERROR HY000: Window frame is not allowed with 'ntile'
SELECT a, b, NTILE(3) OVER(PARTITION BY b ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) ntile FROM t1;
ERROR HY000: Window frame is not allowed with 'ntile'
DROP DATABASE mcs130_db;
