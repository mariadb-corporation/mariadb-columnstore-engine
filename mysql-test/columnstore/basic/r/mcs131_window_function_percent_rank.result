DROP DATABASE IF EXISTS mcs131_db;
CREATE DATABASE mcs131_db;
USE mcs131_db;
CREATE TABLE t1 (a CHAR(1), b INT)ENGINE=Columnstore;
INSERT INTO t1 VALUES ('', NULL),('a', 123),('a', 1),('b', 123),('c', 1861),('c', 1991),('d', 10701),('d', 1071),('a', 92);
SELECT a, b, PERCENT_RANK() OVER(ORDER BY a) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	92	0.1250000000
a	1	0.1250000000
a	123	0.1250000000
b	123	0.5000000000
c	1991	0.6250000000
c	1861	0.6250000000
d	1071	0.8750000000
d	10701	0.8750000000
SELECT a, b, PERCENT_RANK() OVER(ORDER BY b DESC) percent_rank FROM t1;
a	b	percent_rank
d	10701	0.0000000000
c	1991	0.1250000000
c	1861	0.2500000000
d	1071	0.3750000000
a	123	0.5000000000
b	123	0.5000000000
a	92	0.7500000000
a	1	0.8750000000
NULL	NULL	1.0000000000
SELECT a, b, PERCENT_RANK() OVER(ORDER BY a) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	92	0.1250000000
a	1	0.1250000000
a	123	0.1250000000
b	123	0.5000000000
c	1991	0.6250000000
c	1861	0.6250000000
d	1071	0.8750000000
d	10701	0.8750000000
SELECT a, b, PERCENT_RANK() OVER(ORDER BY b DESC) percent_rank FROM t1;
a	b	percent_rank
d	10701	0.0000000000
c	1991	0.1250000000
c	1861	0.2500000000
d	1071	0.3750000000
a	123	0.5000000000
b	123	0.5000000000
a	92	0.7500000000
a	1	0.8750000000
NULL	NULL	1.0000000000
SELECT a, b, PERCENT_RANK() OVER w percent_rank FROM t1 WINDOW w AS (ORDER BY a DESC);
a	b	percent_rank
d	10701	0.0000000000
d	1071	0.0000000000
c	1861	0.2500000000
c	1991	0.2500000000
b	123	0.5000000000
a	92	0.6250000000
a	123	0.6250000000
a	1	0.6250000000
NULL	NULL	1.0000000000
SELECT a, b, PERCENT_RANK() OVER w percent_rank FROM t1 WINDOW w AS (ORDER BY b);
a	b	percent_rank
NULL	NULL	0.0000000000
a	1	0.1250000000
a	92	0.2500000000
b	123	0.3750000000
a	123	0.3750000000
d	1071	0.6250000000
c	1861	0.7500000000
c	1991	0.8750000000
d	10701	1.0000000000
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY a ORDER BY a DESC) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	92	0.0000000000
a	1	0.0000000000
a	123	0.0000000000
b	123	0.0000000000
c	1991	0.0000000000
c	1861	0.0000000000
d	1071	0.0000000000
d	10701	0.0000000000
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY a ORDER BY b DESC) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	123	0.0000000000
a	92	0.5000000000
a	1	1.0000000000
b	123	0.0000000000
c	1991	0.0000000000
c	1861	1.0000000000
d	10701	0.0000000000
d	1071	1.0000000000
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY a ORDER BY b ASC) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	1	0.0000000000
a	92	0.5000000000
a	123	1.0000000000
b	123	0.0000000000
c	1861	0.0000000000
c	1991	1.0000000000
d	1071	0.0000000000
d	10701	1.0000000000
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY b ORDER BY a DESC) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	1	0.0000000000
a	92	0.0000000000
b	123	0.0000000000
a	123	1.0000000000
d	1071	0.0000000000
c	1861	0.0000000000
c	1991	0.0000000000
d	10701	0.0000000000
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY b ORDER BY b DESC) percent_rank FROM t1;
a	b	percent_rank
NULL	NULL	0.0000000000
a	1	0.0000000000
a	92	0.0000000000
b	123	0.0000000000
a	123	0.0000000000
d	1071	0.0000000000
c	1861	0.0000000000
c	1991	0.0000000000
d	10701	0.0000000000
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY a) percent_rank FROM t1;
ERROR HY000: No order list in window specification for 'percent_rank'
SELECT a, b, PERCENT_RANK() OVER(PARTITION BY b) percent_rank FROM t1;
ERROR HY000: No order list in window specification for 'percent_rank'
DROP DATABASE mcs131_db;
