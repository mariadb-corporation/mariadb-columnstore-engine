DROP DATABASE IF EXISTS mcs127_db;
CREATE DATABASE mcs127_db;
USE mcs127_db;
CREATE TABLE t1 (a CHAR(1), b INT)ENGINE=Columnstore;
INSERT INTO t1 VALUES ('', NULL),('a', 123),('a', 1),('b', 123),('c', 1861),('c', 1991),('d', 10701),('d', 1071),('a', 92);
SELECT a, b, LAST_VALUE(b) OVER(ORDER BY a) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	92	123
a	1	123
a	123	123
b	123	123
c	1991	1861
c	1861	1861
d	1071	10701
d	10701	10701
SELECT a, b, LAST_VALUE(b) OVER(ORDER BY b DESC) last_value FROM t1;
a	b	last_value
d	10701	10701
c	1991	1991
c	1861	1861
d	1071	1071
a	123	123
b	123	123
a	92	92
a	1	1
NULL	NULL	NULL
SELECT a, b, LAST_VALUE(a) OVER(ORDER BY b) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	1	a
a	92	a
b	123	a
a	123	a
d	1071	d
c	1861	c
c	1991	c
d	10701	d
SELECT a, b, LAST_VALUE(b) OVER(ORDER BY a DESC) last_value FROM t1;
a	b	last_value
d	10701	1071
d	1071	1071
c	1861	1991
c	1991	1991
b	123	123
a	92	1
a	123	1
a	1	1
NULL	NULL	NULL
SELECT a, b, LAST_VALUE(a) OVER w last_value FROM t1 WINDOW w AS (ORDER BY a DESC);
a	b	last_value
d	10701	d
d	1071	d
c	1861	c
c	1991	c
b	123	b
a	92	a
a	123	a
a	1	a
NULL	NULL	NULL
SELECT a, b, LAST_VALUE(b) OVER w last_value FROM t1 WINDOW w AS (ORDER BY b);
a	b	last_value
NULL	NULL	NULL
a	1	1
a	92	92
b	123	123
a	123	123
d	1071	1071
c	1861	1861
c	1991	1991
d	10701	10701
SELECT a, b, LAST_VALUE(b) OVER(PARTITION BY b) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	1	1
a	92	92
b	123	123
a	123	123
d	1071	1071
c	1861	1861
c	1991	1991
d	10701	10701
SELECT a, b, LAST_VALUE(b) OVER(PARTITION BY a) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	92	123
a	1	123
a	123	123
b	123	123
c	1991	1861
c	1861	1861
d	1071	10701
d	10701	10701
SELECT a, b, LAST_VALUE(a) OVER(ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
a	b	last_value
NULL	NULL	d
a	1	d
a	92	d
b	123	d
a	123	d
d	1071	d
c	1861	d
c	1991	d
d	10701	d
SELECT a, b, LAST_VALUE(b) OVER(ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
a	b	last_value
NULL	NULL	10701
a	1	10701
a	92	10701
b	123	10701
a	123	10701
d	1071	10701
c	1861	10701
c	1991	10701
d	10701	10701
SELECT a, b, LAST_VALUE(b) OVER(PARTITION BY b ORDER BY b DESC RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	1	1
a	92	92
b	123	123
a	123	123
d	1071	1071
c	1861	1861
c	1991	1991
d	10701	10701
SELECT a, b, LAST_VALUE(a) OVER(PARTITION BY b ORDER BY b DESC RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	1	a
a	92	a
b	123	a
a	123	a
d	1071	d
c	1861	c
c	1991	c
d	10701	d
SELECT a, b, LAST_VALUE(b) OVER(PARTITION BY a ORDER BY b DESC RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
a	b	last_value
NULL	NULL	NULL
a	123	1
a	92	1
a	1	1
b	123	123
c	1991	1861
c	1861	1861
d	10701	1071
d	1071	1071
SELECT a, b, LAST_VALUE(b) OVER(PARTITION BY a ORDER BY a DESC RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
ERROR HY000: Numeric datatype is required for RANGE-type frame
SELECT a, b, LAST_VALUE(b) OVER(PARTITION BY b ORDER BY a DESC RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) last_value FROM t1;
ERROR HY000: Numeric datatype is required for RANGE-type frame
DROP DATABASE mcs127_db;
