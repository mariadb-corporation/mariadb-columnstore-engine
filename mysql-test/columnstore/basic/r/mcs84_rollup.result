DROP DATABASE IF EXISTS mcs84_db;
CREATE DATABASE mcs84_db;
USE mcs84_db;
CREATE TABLE booksales ( 
country CHAR(35), genre CHAR(15), year INT, sales INT)
ENGINE=Columnstore;
INSERT INTO booksales VALUES
('Senegal','fiction',2014,12234), ('Senegal','fiction',2015,15647),
('Senegal','non-fiction',2014,64980), ('Senegal','non-fiction',2015,78901),
('Paraguay','fiction',2014,87970), ('Paraguay','fiction',2015,76940),
('Paraguay','non-fiction',2014,8760), ('Paraguay','non-fiction',2015,9030);
SELECT year, SUM(sales) FROM booksales GROUP BY year ORDER BY year;
year	SUM(sales)
2014	173944
2015	180518
SELECT year, SUM(sales) FROM booksales GROUP BY year WITH ROLLUP ORDER BY year;
ERROR HY000: Incorrect usage of CUBE/ROLLUP and ORDER BY
SELECT year, SUM(sales) FROM booksales GROUP BY year WITH ROLLUP;
year	SUM(sales)
2014	173944
2015	180518
NULL	354462
CREATE TABLE three_cols ( key1 INTEGER, key2 INTEGER, value INTEGER) ENGINE=COLUMNSTORE;
INSERT INTO three_cols(key1, key2, value) VALUES
(NULL, NULL, NULL)
, (NULL, NULL,    1)
, (NULL,    1,    2)
, (   1,    1,    3)
, (   1,    2,    4)
, (   1,    2,    5)
, (   2,    3,    6)
, (   2,    3,    7);
SELECT key1, key2, SUM(value), AVG(value), MIN(value), MAX(value), COUNT(value), COUNT(*) FROM three_cols GROUP BY key1, key2 WITH ROLLUP;
key1	key2	SUM(value)	AVG(value)	MIN(value)	MAX(value)	COUNT(value)	COUNT(*)
1	1	3	3.0000	3	3	1	1
1	2	9	4.5000	4	5	2	2
1	NULL	12	4.0000	3	5	3	3
2	3	13	6.5000	6	7	2	2
2	NULL	13	6.5000	6	7	2	2
NULL	1	2	2.0000	2	2	1	1
NULL	NULL	1	1.0000	1	1	1	2
NULL	NULL	28	4.0000	1	7	7	8
NULL	NULL	3	1.5000	1	2	2	3
SELECT key1, key2, GROUP_CONCAT(value) FROM three_cols GROUP BY key1, key2 WITH ROLLUP;
ERROR HY000: Internal error: GROUP_CONCAT and JSONARRAYAGG aggregations are not supported when WITH ROLLUP modifier is used
SELECT key1, key2, JSON_ARRAYAGG(value) FROM three_cols GROUP BY key1, key2 WITH ROLLUP;
ERROR HY000: Internal error: GROUP_CONCAT and JSONARRAYAGG aggregations are not supported when WITH ROLLUP modifier is used
DROP DATABASE IF EXISTS mcs84_db;
